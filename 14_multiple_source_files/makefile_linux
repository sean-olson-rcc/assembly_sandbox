define say
	$(info [Linux Makefile: Chapter 14] $1)
endef

#
REPO_PATH := $(abspath .)
$(call say,REPO_PATH: $(REPO_PATH))

#
YASM_FLAGS := -f elf64 -g dwarf2
LINK_FLAGS := -g

#
BIN_NAME := main_l
BIN := ./$(BIN_NAME)

#
default:	help
.PHONY: default


help:
	@echo "***** Makefile Menu *****"
	@echo
	@echo "make help          ==> This menu"
	@echo
	@echo "make build         ==> Build the program"
	@echo "make run           ==> Run the program"
	@echo "make debug         ==> Debug the program"
	@echo
	@echo "make clean         ==> Clean the build area"
	@echo
.PHONY: help

#
build:	$(BIN)
.PHONY: build

#
run:	$(BIN)
	$(BIN)
.PHONY: run

#
debug:	build
	gdb $(BIN_NAME) -x gdb-commands.txt
.PHONY: debug

#
clean:
	-rm -f *.o
	-rm -f $(BIN)
.PHONY: clean

#
$(BIN):	main_l.o stats_l.o
	ld $(LINK_FLAGS) *_l.o -o $(BIN)

#
main_l.o:	main_l.asm 
	yasm $(YASM_FLAGS) main_l.asm -o main_l.o -l main_l.list


stats_l.o:	stats_l.asm
	yasm $(YASM_FLAGS) stats_l.asm -o stats_l.o -l stats_l.list


